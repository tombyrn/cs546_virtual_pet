<h1>Simon Memory Game</h1>
<h2></h2>
<button type="button" class="start btn btn-lg">Start</button>
<div class="main-container">
    <div class="main-row">
        <div type="button" id="green" class="button green">
        </div>
        <div type="button" id="red" class="button red">
        </div>
    </div>
    <div class="main-row">
        <div type="button" id="yellow" class="button yellow">
        </div>
        <div type="button" id="blue" class="button blue">
        </div>
    </div>
</div>

<form method="get" url="/home/play">
    <button id="game2" class="btn btn-primary" type="submit" formaction="/home/play">
        Back To Game studio
    </button>
</form>

<script>
    var gamePattern = [];

    var userClickedPattern = [];

    var buttonColour = ["red", "blue", "green", "yellow"];

    var started = false;

    var level = 0;

    var length;

    var c = 1; // Count variable for "restart' button 

    function nextSequence() {
        level++;
        $("h1").text("Level :" + level);
        var randomNumber = Math.floor(Math.random() * 4);
        var randomChosenColour = buttonColour[randomNumber];
        gamePattern.push(randomChosenColour);
        var val = $("#" + randomChosenColour);
        val.fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);
        playsound(randomChosenColour);
        console.log("Current Pattern")
        console.log(gamePattern)
    }
    $(".button").on("click", function () {
        var userChosenColour = $(this).attr("id");
        userClickedPattern.push(userChosenColour);
        playsound(userChosenColour);
        animatePress(userChosenColour);
        length = userClickedPattern.length;
        checkAnswer(length - 1);
        console.log("Use patter");
        console.log(userClickedPattern)
    });

    function playsound(name) {
        var sound = new Audio("/sounds/" + name + ".mp3");
        sound.play();
    }

    function animatePress(currentColour) {
        $("#" + currentColour).addClass("pressed");
        setTimeout(function () {
            $("#" + currentColour).removeClass("pressed");
        }, 80);
    }

    // detect mouse click on 'Start' button
    $(".start").on("click", function () {
        if (!started) {
            $("h1").text("Level :" + level);
            nextSequence();
            started = true;
            $(".start").remove();
        }
    });



    async function checkAnswer(currentLevel) {
        if (gamePattern[currentLevel] === userClickedPattern[currentLevel]) {
            if (gamePattern.length === userClickedPattern.length) {
                if (level == 5) {
                    $("h1").text("Congrats!!!You have won");
                    $("h2").text("You earned 50 points");
                    await ($.post('/addUserPoints', {points: 50}))
                    started = false;
                    level = 0;
                    $(".main-container").before('<button type="button" class="restart btn btn-lg ">Restart</button>');
                    $(".restart").on("click", function () {
                        if (!started) {
                            $("h1").text("Level :" + level);
                            nextSequence();
                            started = true;
                            $(".restart").remove();
                        }

                    })
                }
                else {
                    setTimeout(function () {
                        nextSequence();

                    }, 1000);
                }

            }
        }
        else {
            $("body").addClass("game-over")
            $("h1").text("Game Over, Press Any Key to Restart");
            var sound2 = new Audio("/sounds/wrong.mp3");
            sound2.play();
            setTimeout(function () {
                $("body").removeClass("game-over")
            }, 200);
            if (c === 1) {
                $(".main-container").before('<button type="button" class="restart btn btn-lg ">Restart</button>');
                c = 0;
                // detect mouse click on 'Restart' button
                $(".restart").on("click", function () {
                    if (!started) {
                        $("h1").text("Level :" + level);
                        nextSequence();
                        started = true;
                        $(".restart").remove();
                    }

                })
            }
            startOver();
        }
    }

    function startOver() {
        level = 0;
        gamePattern = [];
        started = false;
    }

</script>